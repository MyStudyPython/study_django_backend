# 接入swagger
安装django-rest-swagger 或者 drf_yasg
- django-rest-swagger和drf_yasg都是用于在Django REST Framework项目中自动生成API文档的工具
- django-rest-swagger是针对Django REST Framework v2编写的，而drf_yasg是针对Django REST Framework v3+编写的
- drf_yasg提供了更多的功能和选项，可以更灵活地定制API文档的生成过程

# 安装drf_yasg
```sh
pip3 install drf_yasg
```
**这里得用pip3,不能用pip,因为安装Python包时与Python 3兼容**

# 配置settings 文件
rest_framework            drf接口框架

drf_yasg                  第三方库

```python
INSTALLED_APPS = [
    ...
    'rest_framework',
    'drf_yasg',
]
```

# 配置url 路由
```python
...
# ===================== 自动生成API文档=========================
from drf_yasg.views import get_schema_view
from drf_yasg import openapi
 
schema_view = get_schema_view(
    openapi.Info(
        title="API接口文档平台",  # 必传
        default_version='v1',  # 必传
        description="这是一个接口文档",
        license=openapi.License(name="BSD License"),
    ),
    public=True,
    permission_classes=(permissions.AllowAny,),   # 权限类
)
 
urlpatterns = [
    ...
    # ===================== 自动生成API文档=========================
    path("", RedirectView.as_view(url="/swagger/")),
    path(
        "swagger/",
        schema_view.with_ui("swagger", cache_timeout=0),
        name="schema-swagger-ui",
    ),
    path(
        "redoc/",
        schema_view.with_ui("redoc", cache_timeout=0),
        name="schema-redoc",
    ),
    ...
]
```

http://127.0.0.1:8000/redoc/

[![Snipaste-2023-07-26-16-19-31.png](https://i.postimg.cc/W4wv9604/Snipaste-2023-07-26-16-19-31.png)](https://postimg.cc/Z9n2nN7k)


http://127.0.0.1:8000/swagger

[![Snipaste-2023-07-26-16-21-55.png](https://i.postimg.cc/y89g8tCr/Snipaste-2023-07-26-16-21-55.png)](https://postimg.cc/Mn6KssTy)

# 导入到apifox 中
我这里使用了 Swagger url的导入
[![Snipaste-2023-07-26-16-40-45.png](https://i.postimg.cc/tTrjh3xV/Snipaste-2023-07-26-16-40-45.png)](https://postimg.cc/njQgxQTH)

其他导入方式请见 https://apifox.com/help/api-docs/importing-api/swagger

**但之后我写一个api就要导入一次很麻烦，这里采用自动化部署 jenkins**

# jenkins自动化部署
每次提交代码后，需要手动部署项目，随着团队人数越来越多，提交的次数也越多，部署的时间占用了我越来越多的时间

## windows 系统
### 1. [官网下载](https://www.jenkins.io/download/)
选择长期支持并且稳定的windows版本
![](https://img-blog.csdnimg.cn/17d1e7016b2a49e9bebebed1ca684d7d.png)

**安装jenkins之前需要安装一下jdk**
### 2.安装jdk和配置环境
安装就无脑咔咔咔的安装
**因为一般我们使用的jdk版本为jdk1.8，但是jenkins新版本规定，必须使用jdk11以上版本的jdk，所以，我们的环境中可能存在多个jdk**
具体怎么配置请百度

### 3. 安装jenkins
1. 点击安装jenkins.mis
   
   ![](https://img-blog.csdnimg.cn/94535a65d1e44ee9ac5ad2075cfbf211.png)

2. 设置安装路径，之后next
   
   ![](https://img-blog.csdnimg.cn/00192fa60fe54f3e8621f5dcf4d6dc03.png)

3. 选择`Run service as LocalSystem`,选这个安装简单，如果为了安全，可以选择第二个；
   
   ![](https://img-blog.csdnimg.cn/98f8d8ebbae840a19185bdab63a67791.png)

4. 设置端口号为18080，由于8080经常被开发的项目使用，这里使用了18080
   
   ![](https://img-blog.csdnimg.cn/e9a594e6af024382bbc8ee9d491ffd32.png)

5. 点击Test Port,之后Next
   
   ![](https://img-blog.csdnimg.cn/c1ea81d2309740c3b6770e844e187aec.png)

6. Jenkins需要依赖JDK11,这里使用jdk-11.0.17
   
   ![](https://img-blog.csdnimg.cn/4e0e1613213349fe91aeeb0b83785d75.png)

7. 保持默认，继续下一步
   
   ![](https://img-blog.csdnimg.cn/610ecc5aee5446dd8b3e987431cf988e.png)

8. 配置好JENKINS_HOME环境变量后，开始Install安装
   
   ![](https://img-blog.csdnimg.cn/14fe275d040942a49288ba4ef4e58c74.png)

9. 中间点击确定，之后到达这个页面，点击Finish完成
   
   ![](https://img-blog.csdnimg.cn/ef62fc5ca02e46bdb2d1b230faf5b3ed.png)

### 4.修改jenkins.xml配置文件
1. 查看“服务”，jenkin已经运行了，win系统中，jenkins是以服务的形式运行的，这样也比较方便；
   
   ![](https://img-blog.csdnimg.cn/1643f2547c074b00a8790546faf26bbf.png)

2. 由于jenkins文件数据默认安装到了C:\ProgramData\Jenkins，现在将数据更换放置到D盘D:\Program Files\Jenkins\Jenkins_home
   先停止jenkins服务

   ![](https://img-blog.csdnimg.cn/636342bc62d144c2bb760b6a8ac7c407.png)

3. 修改jenkins安装目录中的配置文件

   [![Snipaste-2023-07-27-14-41-46.png](https://i.postimg.cc/FHb5fFDM/Snipaste-2023-07-27-14-41-46.png)](https://postimg.cc/tsgmwb0k)

   修改JENKINS_HOME为D:\Program Files\Jenkins\Jenkins_home

   [![Snipaste-2023-07-27-14-15-05.png](https://i.postimg.cc/wv8wDDMF/Snipaste-2023-07-27-14-15-05.png)](https://postimg.cc/67cVX2dG)

   修改最大堆内存为512m,256m的太小了；
   同时修改webroot路径为%JENKINS_HOME%\war ---> D:\kf\jenkins_home\war;
   注释掉的–httpPort 和 --webroot，用\来分隔了,不然xml文件报错，无法启动

   [![Snipaste-2023-07-27-14-17-20.png](https://i.postimg.cc/qvWwd2s0/Snipaste-2023-07-27-14-17-20.png)](https://postimg.cc/CRHkGBr6)

   ​ 修改pid的位置

   [![Snipaste-2023-07-27-14-18-15.png](https://i.postimg.cc/Tw3p74KP/Snipaste-2023-07-27-14-18-15.png)](https://postimg.cc/yJ21WnXq)

4. 启动 jenkins服务
   
   ![](https://img-blog.csdnimg.cn/e6b82f629e574e898f21cd276a6eef9d.png)

### 5.浏览器访问，进行初始设置